(function(a,t,e){a(e).ready(function(){function r(a,t,e){var r;return function(){var s=this,i=arguments,d=function(){r=null,e||a.apply(s,i)},_=e&&!r;clearTimeout(r),r=setTimeout(d,t),_&&a.apply(s,i)}}function s(a,t){var e=Number(a);if(isNaN(e))return"0";var r=e.toFixed(t?0:2).toString();return r.indexOf(".")>-1&&(r=r.replace(/(\.\d*?[1-9])0+$/,"$1"),r=r.replace(/\.0+$/,"")),Number(r)}var i=t.ElementPlus;const d={data:()=>a.extend({svg:{refresh:'<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z"></path></svg>',table_option:'<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M389.44 768a96.064 96.064 0 0 1 181.12 0H896v64H570.56a96.064 96.064 0 0 1-181.12 0H128v-64zm192-288a96.064 96.064 0 0 1 181.12 0H896v64H762.56a96.064 96.064 0 0 1-181.12 0H128v-64zm-320-288a96.064 96.064 0 0 1 181.12 0H896v64H442.56a96.064 96.064 0 0 1-181.12 0H128v-64z"></path></svg>'},loading:{shipping_table_list:!0,shipping_dialog_submit_but:!1,update_option_but:!1,express_traces:!0,after_sale_record_html:!1},win:{width:t.innerWidth}},t._vue_data),watch:{$route:function(a){var t=a.path;if(t=t.replace(/^\//,""),t=t.replace(/-/g,"_"),this[t+"_data"]){var e=a.query;for(var r in e){var s=e[r];"search"!=r?"search_filter"!=r?(["status","shipping_status","after_sale_status","order_type","rebate_status","income_status"].includes(r)&&(s=s.includes(",")?s.split(","):[s],s=s.map(a=>~~a)),["after_sale_type"].includes(r)&&(s=s.includes(",")?s.split(","):[s]),this[t+"_data"].filter[r]=s):this[t+"_data"].search_filter=[s]:this[t+"_data"].search=s}this.getTableList(t)}else this.getDashboardData()},"dashboard.order_chart_data.show_tab":function(a){this.dashboard.order_chart_data[a].is_init||this.getOrderChartData(a)}},mounted(){setTimeout(function(){a("#zibpay_app ~ .loading-mask").fadeOut(300)},100);var e=this;t.addEventListener("resize",r(function(){e.win.width=t.innerWidth},100))},created(){let a=this;a.ajax=r(a._ajax,100)},methods:{menuGo(a){this.go(a,{})},go(a,t){t=t||{},this.$router.push({path:a,query:t})},goParams(a){this.$router.replace({path:this.$router.currentRoute.value.path,query:a})},getDashboardData(){var a=this;a.getOrderChartData(),a.getStatisticsData(),a.getTypePieData(),a.getHotData(),a.getAssetData()},getStatisticsData(){var a=this,t=a.dashboard;a.loading.statistics=!0,a._ajax("admin_statistics_data",{},function(e){if(e.mini_card_data&&(t.mini_card_data=e.mini_card_data),e.todo_data&&(t.todo_data=e.todo_data),e.mini_chart_data){var r=t.mini_chart_data.today_sales.chart;r.xAxis.data=e.mini_chart_data.today_sales.time,r.series.data=e.mini_chart_data.today_sales.price,t.mini_chart_data.today_sales.data=r.series.data[0];var i=r.series.data.slice(-1)[0],d=r.series.data.slice(-2)[0],_=s((i-d)/(d>0?d:1));t.mini_chart_data.today_sales.data=i,t.mini_chart_data.today_sales.ratio=a.priceCut(_,"price");var o=t.mini_chart_data.month_sales.chart;o.xAxis.data=e.mini_chart_data.month_sales.time,o.series.data=e.mini_chart_data.month_sales.price;var n=o.series.data.slice(-1)[0],h=o.series.data.slice(-2)[0];_=s((n-h)/(h||1)),t.mini_chart_data.month_sales.data=n,t.mini_chart_data.month_sales.ratio=a.priceCut(_,"price")}})},getHotData(){var a=this;a.loading.hot_product_data=!0,a._ajax("admin_hot_product_data",{order_type:a.dashboard.hot_product_data.order_type,time:a.dashboard.hot_product_data.time},function(t){a.dashboard.hot_product_data.data=t.data,a.dashboard.hot_product_data.max=t.max,a.sortHotData()})},sortHotData(){var a=this.dashboard.hot_product_data,t=a.data;"price"==a.type?t.sort((a,t)=>t.price-a.price):t.sort((a,t)=>t.count-a.count)},getAssetData(){var a=this,t=a.dashboard.asset_data;a.loading.asset_data=!0,a._ajax("admin_asset_ranking_data",{time:t.time},function(a){t.rebate_data=a.rebate_data,t.income_data=a.income_data,t.points_data=a.points_data,t.balance_data=a.balance_data})},getTypePieData(a){var t=this,e=t.dashboard.type_pie_data;a=a||e.type,t.loading.type_pie=!0,t._ajax("admin_type_pie_data",{time:e.time,type:a},function(a){e.chart.series.data=a.data})},getOrderChartData(a){var t=this;a=a||t.dashboard.order_chart_data.show_tab;var e=t.dashboard.order_chart_data[a];e.is_init=!0,t.loading.order_chart=!0,t._ajax("admin_order_chart_data",{order_type:e.order_type,cycle:a,time:t.timefilterFormat(e.timefilter)},function(a){e.chart.xAxis.data=a.chart.time,e.chart.series[0].data=a.chart.price,e.chart.series[1].data=a.chart.nums,e.minitable=a.table})},AuthorAddressSubmit(){var a=this,t={address:a.author_data.new_address_dialog_data,user_id:a.author_data.author_id};a.loading.author_address_submit_but=!0,a.ajax("shop_save_author_address",t,function(t){!t.error&&t.data&&(a.author_data.new_address_dialog_show=0,a.after_sale_data.return_address_dialog_data=t.data,a.after_sale_data.handle_dialog_data.author_info.author_address=a.after_sale_data.return_address_dialog_data)})},setDefaultAddress(a){a.is_default=!0;var t=this;t.author_data.new_address_dialog_data=a,t.AuthorAddressSubmit()},editAddress(a){this.author_data.new_address_dialog_data=a,this.author_data.new_address_dialog_show=1},deleteAddress(a){if(confirm("确定删除此地址？")){var t=this,e={address_id:a};this.ajax("shop_delete_author_address",e,function(a){!a.error&&a.data&&(t.after_sale_data.return_address_dialog_data=a.data,t.after_sale_data.handle_dialog_data.author_info.author_address=t.after_sale_data.return_address_dialog_data)})}},afterSaleSelectAddress(a){this.after_sale_data.handle_dialog_data.return_address=a,this.after_sale_data.return_address_dialog_show=0},afterSaleAddNewAddress(){this.author_data.new_address_dialog_show=1,this.author_data.new_address_dialog_data={id:"",name:"",phone:"",province:"",city:"",county:"",address:"",tag:"",is_default:!1}},afterSaleStatusChange(a){a=a?[~~a]:[],this.after_sale_data.filter.after_sale_status=a,this.getTableList("after_sale")},afterSaleExpressDialog(a,t){var e=this;t=t||"user_return",this.loading.express_dialog=!0,this.express_dialog_data.show=1,this.express_dialog_data.type=t,this.express_dialog_data.express_data=[],"user_return"===t&&(this.express_dialog_data.address_data=a.after_sale_data.return_address),"author_return"===t&&(this.express_dialog_data.address_data=a.order_data.consignee.return_address),this.ajax("after_sale_express_data",{id:a.id,type:t},function(a){a.express_data&&(e.express_dialog_data.express_data=a.express_data)})},afterSaleHandle(a){this.after_sale_data.handle_dialog_data=a,this.after_sale_data.handle_dialog_show=1,this.after_sale_data.details_drawer_show=0;var t=a.author_info.author_address;this.after_sale_data.handle_dialog_data.return_address=t?t.find(a=>a.is_default):null},afterSaleDetails(a){var t=this,e=t.after_sale_data;t.shipping_data.details_drawer_show=!1,e.details_drawer_show=1,e.details_drawer_data=a,e.handle_dialog_show=0,e.details_drawer_data.after_sale_record_html="",t.loading.after_sale_record_html=!1,e.details_drawer_data.after_sale_record_count<1||(t.loading.after_sale_record_html=!0,t.ajax("admin_after_sale_record_html",{id:a.id},function(a){a.html&&(e.details_drawer_data.after_sale_record_html=a.html)}))},afterSaleReturnAddressDialog(){this.author_data.author_id=this.after_sale_data.handle_dialog_data.author_info.author_id,this.after_sale_data.return_address_dialog_show=1,this.after_sale_data.return_address_dialog_data=this.after_sale_data.handle_dialog_data.author_info.author_address||[]},afterSaleHandleSubmit(){var a=this;a.loading.handle_dialog_submit_but=!0;var t=a.after_sale_data.handle_dialog_data,e={id:t.id,handle_type:t.handle_type,author_remark:t.author_remark,refund_channel:"points"===t.pay_modo?"points":t.refund_channel,return_address:t.return_address};if("agree"!==t.handle_type){if(!confirm("确认拒绝此售后申请？"))return void(a.loading.handle_dialog_submit_but=!1)}else if(["refund","insured_price"].includes(t.after_sale_type)){var r="balance"==t.refund_channel||"points"===t.refund_channel?"确定同意退款？同意后系统将自动退款到用户账户！":"确定同意退款，并已将退款金额打入用户账户？";if(!confirm(r))return void(a.loading.handle_dialog_submit_but=!1);e.price=t.after_sale_data.price}a.ajax("admin_after_sale_handle_submit",e,function(t){t.error||(a.after_sale_data.handle_dialog_show=0,a.refreshTheTableList())})},afterSalerefundReturnSubmit(){var a=this;a.loading.handle_dialog_submit_but=!0;var t=a.after_sale_data.handle_dialog_data,e={id:t.id,handle_type:t.handle_type,author_remark:t.author_remark,refund_channel:"points"===t.pay_modo?"points":t.refund_channel,return_address:t.return_address};a.ajax("admin_after_sale_refund_return_handle",e,function(t){t.error||(a.after_sale_data.handle_dialog_show=0,a.refreshTheTableList())})},shippingSubmit(){var a=this;a.loading.shipping_dialog_submit_but=!0;var t=a.shipping_data.shipping_dialog_data,e={id:t.id,express_number:t.express_number,express_company_name:t.express_company_name,delivery_content:t.delivery_content,delivery_remark:t.delivery_remark,delivery_type:t.manual_delivery_type};a.ajax("admin_shipping_submit",e,function(t){t.error||(a.shipping_data.shipping_dialog_show=0,a.refreshTheTableList())})},refreshTheTableList(){var a=this.$router.currentRoute.value.path;a=a.replace(/^\//,""),a=a.replace(/-/g,"_"),this[a+"_data"]&&this.getTableList(a)},shippingDetails(a){this.shipping_data.details_drawer_data=a,this.shipping_data.details_drawer_show=1,this.shipping_data.shipping_dialog_show=0,this.after_sale_data.details_drawer_show=0,this.loading.express_traces=0,a.shipping_status>=1&&"express"===a.shipping_type&&a.shipping_data.express_number&&(this.loading.express_traces=!0,this.getExpressData(a))},getExpressData(a){this.ajax("shipping_express_data",{order_id:a.id},function(t){t.express_data&&(a.express_data=t.express_data)})},shippingStatusChange(a){a=""!==a?[~~a]:[],this.shipping_data.filter.shipping_status=a,this.getTableList("shipping")},showShippingDialog(a){0!=a.status?-1!=a.status?(this.shipping_data.shipping_dialog_data=a,this.shipping_data.shipping_dialog_data.manual_delivery_type="express",this.shipping_data.shipping_dialog_show=1,this.shipping_data.details_drawer_show=0):i.ElNotification.error("订单已关闭，无法发货"):i.ElNotification.error("订单未付款，无法发货")},afterSaleDbSort(a){this.DbSort(a,"after_sale")},shippingDbSort(a){this.DbSort(a,"shipping")},orderDbSort(a){this.DbSort(a,"order")},DbSort(a,t){this[t+"_data"].order=a.order,this[t+"_data"].orderby=a.prop,this.getTableList(t)},dBRefresh(a){this[a+"_data"].order="",this[a+"_data"].orderby="",this[a+"_data"].search="",this[a+"_data"].search_filter="",this[a+"_data"].filter={};for(let t in this[a+"_data"].timefilter)this[a+"_data"].timefilter[t]=[];this[a+"_data"].current_page=1,this[a+"_data"].page_size=20,this.goParams({})},dBSearch(a){this.getTableList(a)},dbFilter(a){this.getTableList(a)},dBPagChange(a,t){this.getTableList(a,t)},getTableList(a,t){var e=this;e.loading[a+"_table_list"]=!0;var r=e[a+"_data"],s={paged:r.current_page,pagesize:r.page_size,order:r.order,orderby:r.orderby,search:r.search,search_filter:r.search_filter,filter:r.filter,timefilter:e.getDbTimefilter(r.timefilter)};"current"===t&&(s.pag_total=r.total),e.ajax("admin_"+a+"_table_list",s,function(a){r.lits_data=a.lits_data||[],r.total=~~(a.count||0),r.status_count=a.status_count||[],a.statistics_data&&(r.statistics_data=a.statistics_data)})},timefilterFormat(a){if(!a||!Array.isArray(a)||2!==a.length)return[];let t=function(a,t){if(!a)return"";const e=new Date(a),r=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),_=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return t.replace("YYYY",r).replace("MM",s).replace("DD",i).replace("HH",d).replace("mm",_).replace("ss",o)},e=a[0]?t(a[0],"YYYY-MM-DD 00:00:00"):"",r=a[1]?t(a[1],"YYYY-MM-DD 23:59:59"):"";return[e,r]},getDbTimefilter(a){for(let t in a)a[t]=this.timefilterFormat(a[t]);return a},priceFormat(a,t){return"points"===t?~~a+"积分":this.marks.pay+Number(a).toFixed(2).toString().replace(/\.?0+$/,"")},priceCut:(a,t)=>(("points"===t||a>1e4)&&(a=~~a),a=Number(a).toFixed(2).toString().replace(/\.?0+$/,""),a>1e5&&(a=(a/1e4).toFixed(2).toString().replace(/\.?0+$/,"")+"w"),a),isExist:t=>!a.isEmptyObject(t),copyAddress(a){var t=a.name+" "+a.phone+" "+a.province+a.city+a.county+a.address;this.copy(t)},copy(a){var r=e.createElement("input");if(r.value=a,e.body.appendChild(r),navigator.userAgent.match(/ipad|iphone/i)){var s=e.createRange();s.selectNodeContents(r);var d=t.getSelection();d.removeAllRanges(),d.addRange(s),r.setSelectionRange(0,999999)}else r.select();var _={offset:40,type:"danger",message:"复制失败，请手动复制",zIndex:10000010};try{e.execCommand("Copy")&&(_={offset:40,type:"success",message:"内容已复制",zIndex:10000010})}catch(a){}i.ElNotification(_),e.body.removeChild(r)},closeOrder(a){a.status=-1},clearOrder(){if(confirm("清理订单会删除2周前所有已关闭的订单，不可恢复！确认清理订单？\n备注：系统每个月会自动清理一次已关闭订单，您可以无需手动清理")){var a=this;a._ajax("admin_clear_order",{},function(){a.dBRefresh("order")})}},dateShortcutsDate:()=>[{text:"最近7天",value:(()=>{const a=new Date,t=new Date;return t.setDate(t.getDate()-7),[t,a]})()},{text:"本月",value:(()=>{const a=new Date,t=new Date;return t.setDate(1),[t,a]})()},{text:"今年",value:(()=>{const a=new Date,t=new Date((new Date).getFullYear(),0);return[t,a]})()},{text:"去年",value:(()=>{const a=new Date((new Date).getFullYear(),0);a.setDate(a.getDate()-1);const t=new Date((new Date).getFullYear()-1,0);return[t,a]})()},{text:"最近三个月",value:(()=>{const a=new Date,t=new Date;return t.setMonth(t.getMonth()-3),[t,a]})()},{text:"最近六个月",value:(()=>{const a=new Date,t=new Date;return t.setMonth(t.getMonth()-6),[t,a]})()}],_ajax(t,e,r,s){var d=this;e=e||{},e.action=t,a.ajax({url:d.ajax_url,type:"POST",data:e,dataType:"json",success:function(a){var t,e,s;a.msg&&(t=a.error?"error":a.ys||"success",e=a.title||"",s=a.msg,i.ElNotification({offset:40,title:e,message:s,type:t,zIndex:10000010})),d.stopLoading(),r&&r(a)},error:function(a){i.ElNotification({offset:40,title:"错误",message:"请求失败，请根据浏览器开发者工具查看错误信息",type:"error",zIndex:10000010}),console.error("ajax请求错误 status:"+a.status+" "+a.statusText+" responseText:"+a.responseText,a),s&&s(a),d.stopLoading()}})},stopLoading(){var a=this.loading;for(let t in a)a[t]=!1},refreshModal(t){var e=a('<a href="javascript:;" data-toggle="RefreshModal" data-action="'+t+'" style="display: none;"></a>');e.appendTo("body"),e.click().remove()}}},_={props:{endTime:{type:[String,Number],required:!0},format:{type:String,default:"mm:ss"}},data:()=>({time:0,timer:null,over24h:!1}),computed:{formatTime(){if(this.time<=0)return"已结束";if(this.over24h){const a=Math.floor(this.time/86400),t=Math.floor(this.time%86400/3600);return`${a}天${t}小时`}const a=Math.floor(this.time/60),t=this.time%60;return`${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}},methods:{getEndTime(){if("number"==typeof this.endTime)return this.endTime;const a=Date.parse(this.endTime);if(!isNaN(a))return a;const t=Number(this.endTime);return isNaN(t)?0:t},startTimer(){this.timer&&clearInterval(this.timer);const a=this.getEndTime(),t=(new Date).getTime();this.time=Math.max(0,Math.floor((a-t)/1e3)),this.time>86400?this.over24h=!0:(this.over24h=!1,this.time<=0?this.$emit("timeup"):this.timer=setInterval(()=>{this.time--,this.time<=0&&(clearInterval(this.timer),this.$emit("timeup"))},1e3))}},mounted(){this.startTimer()},beforeUnmount(){this.timer&&clearInterval(this.timer)},template:'\n                <span class="countdown" :title="\'剩余时间：\'+formatTime">{{ formatTime }}</span>\n            '};d.components={CountDown:_};const o=t.Vue.createApp(d),n=t.VueRouter.createRouter({history:t.VueRouter.createWebHashHistory(),routes:[]});o.component("v-chart",t.VueECharts),o.use(i,{locale:t.ElementPlusLocaleZhCn}),o.use(n),o.mount("#zibpay_app")})})(jQuery,window,document);