(function(){function t(t,i){var e=t.offset().top,a=i.offset().top,s=t.offset().left,o=i.offset().left,n=t.width(),d=i.width(),r=t.height(),c=i.height();return{x:o-s-n/2+d/2,y:a-e-r/2+c/2}}function i(t,i){var e=Number(t);if(isNaN(e))return"0";var a=e.toFixed(i?0:2).toString();return a.indexOf(".")>-1&&(a=a.replace(/(\.\d*?[1-9])0+$/,"$1"),a=a.replace(/\.0+$/,"")),Number(a)}function e(t){var e=i(t).toString(),a=e.split("."),s=a[0];return a[1]&&e.includes(".")&&(s+='<span class="decimal-part">.'+a[1]+"</span>"),s}function a(t,i){return"|"+t+"_"+i}function s(t){var i="";return t.forEach(function(t,e){i+=a(e,t)}),i}function o(t){return t?JSON.parse(JSON.stringify(t)):{}}function n(){var t=window,i="inner";return"innerWidth"in window||(i="client",t=document.documentElement||document.body),{width:t[i+"Width"],height:t[i+"Height"]}}function d(){return n().width<768}function r(){$(".signin-loader:eq(0)").click()}function c(t){$("[cart-count]").text(t).attr("cart-count",t)}function l(){return{win_width:$(window).width(),is_mobile:d(),stockAllText:function(t){return isNaN(t)?"":t<0?"":0===t?"缺货":"库存: "+t},spinnerMax:function(t){t=t||this;var i=t.stock_all;return i=-1===i?1e3:i,t.limit_buy&&t.limit_buy.is_limit&&(i=Math.min(i,t.limit_buy.limit)),0===i?1:i},switchOptView:function(t){t.view_mode="img"===t.view_mode?"list":"img"},optHasImg:function(t){return t.opts&&t.opts.length>0&&t.opts.some(t=>t.image)},syncItemStock:function(t,i){var e=t;if(i||(i=t),"opts"===i.stock_type){var a=s(e.options_active);i.stock_opts[a]?e.stock_all=Number(i.stock_opts[a]):e.stock_all=0}else e.stock_all=Number(i.stock_all);-1!==e.stock_all&&(e.selected_count>e.stock_all&&(e.selected_count=e.stock_all?e.stock_all:1),e.stock_all)},syncItemDiscountPrice:function(t,e,a){a||(a=t),e||(e={}),t.discount_hit=[];var s=a.pay_modo&&"points"===a.pay_modo,n=i(t.prices.total_price,s),d=a.discount;if(d){var r=n/t.selected_count,c=e.product_data,l=e.author_data,u=e.total_data,m=e.user_data;$.each(d,function(e,a){if(a=o(a),a.usesed_count=0,a.preferential_amount=0,!a.is_valid)return!0;var s=a.discount_scope;if(a.price_limit){if("item"===s&&r<a.price_limit)return!0;if("product"===s&&c.price<a.price_limit)return!0;if("author"===s&&l.price<a.price_limit)return!0;if("order"===s&&u.price<a.price_limit)return!0}if(a.user_limit){if("vip"===a.user_limit&&m.vip_level<1)return!0;if("vip_2"===a.user_limit&&m.vip_level<2)return!0;if("auth"===a.user_limit&&!m.auth)return!0}if("reduction"===a.discount_type){var d=Number(a.reduction_amount),_=0;a.usesed_count=1,"item"===s&&(a.usesed_count=t.selected_count,_=d*t.selected_count),"product"===s&&(_=d*(t.selected_count/c.count)),"author"===s&&(_=d*(t.selected_count/l.count)),"order"===s&&(_=d*(t.selected_count/u.count)),_>=n&&(_=n),a.preferential_amount=_,n-=_}if("discount"===a.discount_type){var p=n,v=a.discount_amount/10;n*=v,a.usesed_count=1,a.preferential_amount=p-n}"gift"===a.discount_type&&(a.gift_data&&0!==a.gift_data.length||(a.gift_data=[]),a.gift_data.push(a.gift_config)),a.preferential_amount=i(a.preferential_amount),t.discount_hit.push(a)})}t.prices.unit_discount_price=i(n/t.selected_count,s),t.prices.total_discount_price=i(n,s),t.prices.total_discount=i(t.prices.total_price-t.prices.total_discount_price)},syncItemPrice:function(t,e){e||(e=t);var a=t.prices,s=Number(e.prices.start_price);a.start_price=s;var o=t.pay_modo&&"points"===t.pay_modo;t.options_active.length>0&&e.product_options.length>0&&$.each(t.options_active,function(t,i){e.product_options[t]&&e.product_options[t].opts&&e.product_options[t].opts[i]&&(s+=Number(e.product_options[t].opts[i].price_change))});var n=i(s,o);a.unit_price=n,a.unit_discount_price=n;var d=i(s*t.selected_count,o);a.total_price=d,a.total_discount_price=d},newModal:function(t,i){return i=i||"",i&&(i='<div class="border-title touch"><div class="flex jc"><b>'+i+"</b></div></div>"),refresh_modal({class:"shop-modal modal-mini full-sm",mobile_from_bottom:!0,content:'<button class="close abs-close" data-dismiss="modal"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="">'+i+t+"</div>"})},paramsModal:function(t){if(t.length){var i="";return $.each(t,function(t,e){i+='<div class="mb10 flex" style="min-width:80%;"><div class="author-set-left muted-2-color" style="min-width: 80px;">'+e.name+'</div><div class="author-set-right mt6">'+e.value+"</div></div>"}),this.newModal('<div class="mini-scrollbar scroll-y max-vh5" style="min-height: 20vh;">'+i+"</div>","商品参数")}},serviceModal:function(t){var i="";return $.each(t,function(t,e){var a=e.image?'<div class="badg em14 cir"><img src="'+e.image+'" alt="'+e.name+'"></div>':'<div class="badg cir em14"><i class="fa fa-heart-o"></i></div>';i+='<div class="mt10 mb20 flex">'+a+'<div class="ml10">'+e.name+'<div class="muted-2-color em09">'+e.desc+"</div></div></div>"}),this.newModal('<div class="mini-scrollbar scroll-y max-vh5" style="min-height: 20vh;">'+i+"</div>","商品服务")},discountHitModal:function(t,e,a){var s="",o=0;if(!$.isEmptyObject(t)){$.each(t,function(t,n){if(!$.isEmptyObject(n.discount_hit)){var d=n.thumbnail||a[n.product_id].thumbnail,r=n.title||a[n.product_id].title,c=n.options_active_name?'<div class="px12 muted-2-color text-ellipsis">'+n.options_active_name+"</div>":"";s+='<div class="dis-hit-item muted-box mb10">',s+=`<div class="flex ac border-bottom" style="padding-bottom: 10px;">\n                                <div class="badg cir">\n                                ${d}\n                                </div>\n                                <div class="ml10 flex1">\n                                    <div class="title text-ellipsis">${r}</div>\n                                    ${c}\n                                </div>\n                                <div class="muted-2-color">x<span class="em12"> ${n.selected_count||n.count||1}</span></div>\n                            </div>`,s+='<div class="">',$.each(n.discount_hit,function(t,a){var n=a.name||e[a.id].name,d=a.small_badge||e[a.id].small_badge,r=a.usesed_count&&a.usesed_count>1?"x"+a.usesed_count:"";if(n===d&&(n=""),d=d?'<span class="badg badg-sm c-yellow mr3">'+d+r+"</span>":"",a.preferential_amount){var c=i(a.preferential_amount);o+=c,s+=`\n                            <div class="mt10 flex">\n                                <div class="text-ellipsis flex1 mr20 muted-2-color">${d+n}</div>\n                                <div class="desc c-red">-${c}</div>\n                            </div>\n                            `}}),s+="</div></div>"}}),o=i(o);var n=`\n                ${s}\n                <div class="flex muted-box">\n                    <div class="text-ellipsis flex1 mr20">共计优惠</div>\n                    <div class="desc c-red">-${o}</div>\n                </div>\n                `;return this.newModal('<div class="mini-scrollbar scroll-y max-vh5">'+n+"</div>","优惠详情")}},giftDesc:function(t,i){if(!$.isEmptyObject(t)){var e=[];return $.each(t,function(t,i){switch(i.gift_type){case"vip_1":e.push(i.vip_1_name);break;case"vip_2":e.push(i.vip_2_name);break;case"auth":e.push("认证资格");break;case"level_integral":e.push("经验值");break;case"points":e.push("积分");break;case"product":e.push("商品");break;case"other":e.push(i.other_info.name)}}),e.join("、")}},giftModal:function(t){var i="";$.each(t,function(t,e){switch(e.gift_type){case"vip_1":var a="Permanent"===e.vip_time?"永久":e.vip_time+"天";i+='<div class="gift-card-item flex mt6"><div class="gift-name">'+e.vip_1_name+'</div><div class="muted-2-color"> '+a+"</div></div>";break;case"vip_2":a="Permanent"===e.vip_time?"永久":e.vip_time+"天";i+='<div class="gift-card-item flex mt6"><div class="gift-name">'+e.vip_2_name+'</div><div class="muted-2-color"> '+a+"</div></div>";break;case"auth":var s='<div class=""> '+e.auth_info.name+"</div>";s+=e.auth_info.desc?'<div class="px12"> '+e.auth_info.desc+"</div>":"",i+='<div class="gift-card-item flex mt6"><div class="gift-name">认证资格</div><div class="muted-3-color"> '+s+"</div></div>";break;case"level_integral":i+='<div class="gift-card-item flex mt6"><div class="gift-name">经验值</div><div class="muted-2-color"> '+e.level_integral+"</div></div>";break;case"points":i+='<div class="gift-card-item flex mt6"><div class="gift-name">积分</div><div class="muted-2-color"> '+e.points+"</div></div>";break;case"product":i+='<div class="gift-card-item flex mt6"><div class="gift-name">商品</div><div class="muted-2-color"> '+e.product_id+"</div></div>";break;case"other":i+='<div class="gift-card-item flex mt6"><div class="gift-name">'+e.other_info.name+'</div><div class="muted-2-color"> '+e.other_info.desc+"</div></div>"}});var e=`\n                    <div class="gift-card muted-box mb10 relative">\n                            <div class="gift-card-item">\n                                ${i}\n                            </div>\n                    </div>\n                    `,a='<div class="mini-scrollbar scroll-y max-vh5">'+e+"</div>";return this.newModal(a,"赠品详情")},discountModal:function(t,i,a){t=t,i=i;var s=[];if($.isEmptyObject(i)?s=t:$.each(i,function(i,e){s.push(t[e.id])}),!$.isEmptyObject(s)){var o="",n="";$.each(s,function(t,i){if(a||i.is_valid){var s=i.discount_type,d="";switch(s){case"reduction":d='<div class="discount-amount"><div class="price-text">'+i.reduction_amount+'</div><div class="price-type px12">立减</div></div>';break;case"discount":d='<div class="discount-amount"><span class="price-text em14">'+e(i.discount_amount)+'</span><span class="price-type px12 ml6">折</span></div>'}var r='<div class="title">'+i.name+"</div>";r+=i.desc?'<div class="desc opacity8 px12 mt3 text-ellipsis">'+i.desc+"</div>":"";var c=[];if(Number(i.price_limit)>0){var l=i.discount_scope,u="";"item"===l?u="单价":"product"===l?u="商品":"author"===l?u="店铺":"order"===l&&(u="跨店"),c.push('<span class="badg badg-sm">'+u+"满"+i.price_limit+"可用</span>")}if(i.user_limit)switch(i.user_limit){case"vip":c.push('<span class="badg badg-sm">VIP可用</span>');break;case"vip_2":c.push('<span class="badg badg-sm">VIP2可用</span>');break;case"auth":c.push('<span class="badg badg-sm">认证用户可用</span>')}if(r+=c?'<div class="limit-info opacity8 px12 mt3">'+c.join(" & ")+"</div>":"",i.time_limit&&i.time_limit_config)if(i.time_limit_config.show_html)r+=i.time_limit_config.show_html;else if(i.time_limit_config.countdown)r+='<div class="flex ac px12 mt3"><span class="mr3 opacity8 px12">活动仅剩</span><span class="badg badg-sm c-red" int-second="auto" data-countdown="'+i.time_limit_config.end+'" data-over-text="已结束">00分00秒</span></div>';else{var m=i.time_limit_config.start?i.time_limit_config.start.replace(" 00:00:00",""):"",_=i.time_limit_config.end?i.time_limit_config.end.replace(" 23:59:59",""):"",p=m?m+(_?" - ":"开始"):"",v=_?_+(m?"":"结束"):"";r+='<div class="badg badg-sm mt3">'+p+v+"</div>"}if("gift"===i.discount_type){var h="";$.each(i.gift_config,function(t,i){switch(i.gift_type){case"vip_1":var e="Permanent"===i.vip_time?"永久":i.vip_time+"天";h+='<div class="gift-card-item flex mt6"><div class="gift-name">'+i.vip_1_name+'</div><div class="muted-2-color"> '+e+"</div></div>";break;case"vip_2":e="Permanent"===i.vip_time?"永久":i.vip_time+"天";h+='<div class="gift-card-item flex mt6"><div class="gift-name">'+i.vip_2_name+'</div><div class="muted-2-color"> '+e+"</div></div>";break;case"auth":var a='<div class=""> '+i.auth_info.name+"</div>";a+=i.auth_info.desc?'<div class="px12"> '+i.auth_info.desc+"</div>":"",h+='<div class="gift-card-item flex mt6"><div class="gift-name">认证资格</div><div class="muted-3-color"> '+a+"</div></div>";break;case"level_integral":h+='<div class="gift-card-item flex mt6"><div class="gift-name">经验值</div><div class="muted-2-color"> '+i.level_integral+"</div></div>";break;case"points":h+='<div class="gift-card-item flex mt6"><div class="gift-name">积分</div><div class="muted-2-color"> '+i.points+"</div></div>";break;case"product":h+='<div class="gift-card-item flex mt6"><div class="gift-name">商品</div><div class="muted-2-color"> '+i.product_id+"</div></div>";break;case"other":h+='<div class="gift-card-item flex mt6"><div class="gift-name">'+i.other_info.name+'</div><div class="muted-2-color"> '+i.other_info.desc+"</div></div>"}}),n+=`\n                        <div class="gift-card muted-box mb10 relative">\n                            <div class="small-badge">${i.small_badge}</div>\n                            <a class="flex" href="${i.link}" target="_blank">\n                                <div class="gift-card-info flex1">\n                                    ${r}\n                                </div>\n                                <i class="fa fa-angle-right em12 ml10 mt10 opacity8"></i>\n                            </a>\n                                <div class="gift-card-item">\n                                    ${h}\n                                </div>\n                        </div>\n                        `}else o+=`\n                        <a class="discount-card-link" href="${i.link}" target="_blank">\n                        <div class="discount-card muted-box mb10">\n                            <div class="small-badge">${i.small_badge}</div>\n                            <div class="flex ac">\n                                <div class="discount-card-left">\n                                    ${d}\n                                </div>\n                                <div class="discount-card-right flex1">\n                                    ${r}\n                                </div>\n                                <i class="fa fa-angle-right em12 ml6 opacity8"></i>\n                            </div>\n                        </div>\n                        </a>\n                        `}}),o=o?'<div class="discount-card-list">'+o+"</div>":"",n=n?'<div class="discount-card-gift">'+(o?'<div class="title-theme mb10 mt20">赠品</div>':"")+n+"</div>":"";var d='<div class="mini-scrollbar scroll-y max-vh5">'+o+n+"</div>";return this.newModal(d,"优惠信息")}}}}function u(t){var i=this;return i.drawer_id="shop-confirm-modal",i.ajaxget=function(t){$("body").loading("show"),t.action="shop_confirm_modal";var e="",a="confirm_modal_html_"+_win.ver,s=$("#"+i.drawer_id);if(s.length)t.no_html=!0;else{var o=localStorage.getItem(a);o&&(t.no_html=!0,e=o)}$.ajax({url:_win.ajax_url,type:"POST",data:t,dataType:"json",success:function(t){var s=t.ys?t.ys:t.error?"danger":"";t.msg&&notyf(t.msg,s),t.html&&localStorage.setItem(a,t.html),t.vue_data&&i.confirmModal(t.html||e,t.vue_data),$("body").loading("hide")},error:function(){$("body").loading("hide")}})},i.confirmModal=function(t,e){var a=i.drawer_id,s=$("#"+a);s.length?(window.VueShopConfirmData=$.extend(window.VueShopConfirmData,e),window.VueShopConfirmData.order_data=[],window.VueShopConfirmData.payment_data=[],window.VueShopConfirmData.$nextTick(function(){setTimeout(function(){s.find(".scroll-y").scrollTop(0)},100)})):(g.createModal({modal_class:"shop-confirm-modal",dialog_class:"full-sm",title_class:"mb10 flex jc font-bold",mobile_from_bottom:!0,content:'<div class="shop-modal-body" @vue:mounted="mounted">'+t+"</div>",id:a,title:"确认订单"}),s=$("#"+a),p("#"+a,e)),s.modal("show")},i.init=function(){return i.ajaxget(t),{drawer_id:i.drawer_id,$drawer:$("#"+i.drawer_id),ajaxget:i.ajaxget,createApp:i.createApp}},i.init()}function m(){function t(t){const i={};return $.each(t,function(e,a){if(e.endsWith("0000")){const t=a;i[t]={}}else if(e.endsWith("00")&&!e.endsWith("0000")){const s=t[e.substring(0,2)+"0000"],o=a;i[s]&&(i[s][o]=[])}else{const s=t[e.substring(0,2)+"0000"],o=t[e.substring(0,4)+"00"],n=a;s&&!i[s]&&(i[s]={}),o&&!i[s][o]&&(i[s][o]=[]),o?i[s][o].push(n):i[s][n]=[]}}),i}var i="china_regions_"+_win.ver,e=localStorage.getItem(i);if(e)try{return JSON.parse(e)}catch(t){}var a=[];return $.ajax({url:_win.uri+"/inc/functions/shop/assets/js/china-regions.json",type:"GET",dataType:"json",async:!1,success:function(e){var s=t(e);localStorage.setItem(i,JSON.stringify(s)),a=s},error:function(t,i,e){console.error("获取地址数据失败:",e)}}),a}function _(){var t=m(),i={},e="user-manage-address-modal",a="user-address-edit-modal",s=b.ModalId(e).mounted("AddressesMounted").userManageAddressModal(),n=b.ModalId(a).mounted(!1).userAddAddressModal(),r=$.extend({is_mobile:d(),addresses:[],selectedAddressId:0,is_edit:!1,form:{id:0,name:"",phone:"",province:"",city:"",county:"",address:"",tag:"家",is_default:!1},errors:{},regions:t,cities:[],counties:[],customTag:"",showCustomInput:!1,submitting:!1,tag_list:["家","公司","学校"],AddressesMounted:function(){},addModal:function(t){n.modal(t?"show":"hide")},manageModal:function(t){s.modal(t?"show":"hide")},loadAddresses(){const t=this;$.ajax({type:"POST",url:_win.ajax_url,data:{action:"shop_get_user_addresses"},success(i){!i.error&&i.data&&t.updateAddresses(i.data)}})},updateAddresses(t){var i=this;if(i.addresses=t,!i.selectedAddressId){const t=i.addresses.find(t=>t.is_default);t?i.selectedAddressId=t.id:i.addresses.length>0&&(i.selectedAddressId=i.addresses[0].id)}i.updateAddressesCallback(t)},getDefaultAddress(){const t=this.addresses.find(t=>t.is_default);return t||(this.addresses.length>0?this.addresses[0]:[])},updateAddressesCallback:function(t){},selectAddress(t){this.selectedAddressId=t.id,this.manageModal(!1),this.selectAddressCallback(t)},selectAddressCallback:function(t){},addNewAddress(){this.resetForm(),this.is_edit=!1,this.manageModal(!1),n.modal("show")},editAddress(t){this.resetForm(),this.is_edit=!0,this.form={...t},this.form.tag&&!this.tag_list.includes(this.form.tag)&&(this.customTag=this.form.tag),this.provinceChange(!0),this.cityChange(!0),this.manageModal(!1),this.addModal(!0)},deleteAddress(t){if(!confirm("确定要删除这个地址吗？"))return;const i=this;$.ajax({type:"POST",url:_win.ajax_url,data:{action:"shop_delete_user_address",address_id:t},success(e){if(e.error)notyf(e.msg||"删除失败","danger");else{notyf("删除成功","success");var a=i.addresses.filter(i=>i.id!==t);i.updateAddresses(a)}},error(){notyf("网络错误，请稍后重试","danger")}})},editSaveAddress(t){this.validateForm()&&this.saveAddress(this.form,t)},saveAddress(t,i){const e=this;var a={action:"shop_save_user_address",address:t},s=i?$(i.target):$("<div></div>");s.zib_ajax(a,function(t){t.data&&e.updateAddresses(t.data),e.addModal(!1),setTimeout(()=>{e.manageModal(!0)},50)})},setDefaultAddress(t){var i=$(t.target),e=i.attr("item-id");if(e){var a=o(this.addresses.find(t=>t.id===e));a&&(a.is_default=!0,this.saveAddress(a,t))}},validateForm(){return this.errors={},this.form.name||(this.errors.name="请输入收货人姓名"),this.form.phone?/^(?:\d{5,}|\+\d{6,}|[\+]?\d{2,}[\-\s]\d{2,}[0-9|\-|\s]{0,15})$/.test(this.form.phone)||(this.errors.phone="请输入正确的手机号码"):this.errors.phone="请输入手机号码",this.form.province&&this.form.city&&(this.form.county||$.isEmptyObject(this.counties))||(this.errors.region="地区信息不完整"),this.form.address||(this.errors.address="请输入详细地址"),0===Object.keys(this.errors).length},resetForm(){this.form={id:0,name:"",phone:"",province:"",city:"",county:"",address:"",tag:this.tag_list[0],is_default:!1},this.errors={},this.cities=[],this.counties=[],this.customTag="",this.showCustomInput=!1},provinceChange(t){this.cities={},!0!==t&&(this.counties=[],this.form.city="",this.form.county="");const i=o(this.regions[this.form.province]);i&&(this.cities=i),this.form.city&&this.$nextTick(()=>{$(this.$refs.regionCitySelect).val(this.form.city)})},cityChange(t){this.counties=[],!0!==t&&(this.form.county="");const i=this.cities;if(!i)return;const e=o(i[this.form.city]);e&&(this.counties=e),this.form.county&&this.$nextTick(()=>{$(this.$refs.regionCountySelect).val(this.form.county)})},showCustomTagInput(){this.showCustomInput=!0,this.$nextTick(()=>{this.$refs.customTagInput.focus()})},setCustomTag(){this.customTag.trim()&&(this.form.tag=this.customTag.trim()),this.showCustomInput=!1}},i);return f(r,["#"+e,"#"+a]),r}function p(t,i){if(i)e=i;else{var e=$(t).attr("v-config");e=$.parseJSON(e),$(t).removeAttr("v-config")}e.remark_modal_data={remark:""};var a="remark_modal_data";e.$remark_modal=b.ModalId(a).prefix("remark_modal_data").createRemarkModal(),e.user_required_modal_data=[];var s="user_required_modal_data";e.$user_required_modal=b.ModalId(s).prefix("user_required_modal_data").createUserRequiredModal(),e.payment_data=[],e.order_data=[];var n=$.extend(l(),{address_data:null,mounted:function(){var t=this;t.address_data||(t.address_data=_()),t.address_data.selectAddressCallback=function(i){t.user_data.address_data=i},t.address_data.updateAddressesCallback=function(i){if(t.user_data.address_data.id){var e=i.find(i=>i.id===t.user_data.address_data.id);t.user_data.address_data=e||t.address_data.getDefaultAddress()}else t.user_data.address_data=t.address_data.getDefaultAddress()},t.address_data.updateAddresses(o(this.user_data.address_lists_data))},showRemarkModal:function(t){this.remark_modal_data.remark=t.remark||"",this.remark_modal_data.opt_data=t,this.$remark_modal.modal("show")},showUserRequiredModal:function(t){this.user_required_modal_data.user_required=o(t.user_required),this.user_required_modal_data.opt_data=t,this.$user_required_modal.modal("show")},userRequiredValue:function(t,i){return!!i.user_required.length&&(i.user_required.find(i=>i.name===t).value||"")},userRequiredModalSubmit:function(){var t=this.user_required_modal_data.user_required,i=[];if($.each(t,function(t,e){e.value=$("<div>"+e.value+"</div>").text(),e.value?e.error=null:(e.error="请输入"+e.name,i.push(e.name))}),i.length>0)return notyf("请输入"+i.join(","),"warning");this.$user_required_modal.modal("hide"),this.user_required_modal_data.opt_data.user_required=t,setTimeout(()=>{this.user_required_modal_data.user_required=null,this.user_required_modal_data.opt_data=null},300)},remarkModalSubmit:function(){var t=$("<div>"+this.remark_modal_data.remark+"</div>").text();this.remark_modal_data.opt_data.remark=t,this.remark_modal_data.remark="",this.remark_modal_data.opt_data=null,this.$remark_modal.modal("hide")},showAddressModal:function(){var t=this;t.user_data.address_data.id&&(t.address_data.selectedAddressId=t.user_data.address_data.id),this.address_data.manageModal(!0)},submitOrInitiatePay:function(t){this.payment_data&&this.payment_data.order_num?this.initiatePay(t):this.submitOrder(t)},showDiscountHitModal(){var t=[];return this.optsEach(function(i,e,a){t.push(a)}),this.discountHitModal(t,this.discount_data,this.product_data)},showGiftModal:function(t){return this.giftModal(t.gift_data)},submitOrder:function(t){var i=this;if(i.shipping_has_auto&&!i.user_data.email)return notyf("请输入邮箱","warning");if(i.shipping_has_express&&(!i.user_data.address_data.name||!i.user_data.address_data.phone||!i.user_data.address_data.address))return notyf("请选择收货地址","warning");var e={},a=[];if(this.optsEach(function(t,i,s,o){if(s.user_required.length&&$.each(s.user_required,function(t,i){i.value||a.push(i.name)}),a.length>0)return!1;e[s.product_id]||(e[s.product_id]={}),e[s.product_id][o]={count:s.count,remark:s.remark,user_required:s.user_required}}),a.length>0)return notyf("请填写"+a.join(","),"warning");var s={products:e,pay_method:i.pay_data.pay_methods_active,pay_modo:i.total_data.pay_modo,price:i.total_data.pay_price,points:i.total_data.pay_points,address_data:i.user_data.address_data,user_email:i.user_data.email,payment_method:i.pay_data.pay_methods_active,action:"shop_submit_order"};this.config.is_cart&&(s.is_cart=1),$(t.target).zib_ajax(s,function(t){t.payment_data&&(i.order_data=t.order_data,i.payment_data=t.payment_data,i.initiatePay())},"stop")},initiatePay:function(){this.$nextTick(()=>{var t=$(this.$refs.zibpay_form);t.find(".initiate-pay").on("zib_ajax.success",function(t,i){i.error}).click()})},showAddAddressModal:function(){this.address_data.addModal(!0)},paymentMethodChange(t){this.pay_data.pay_methods_active=t},optsEach:function(t){var i=this;$.each(i.item_data,function(i,e){$.each(e,function(e,a){$.each(a,function(a,s){t(i,e,s,a)})})})}},e);return window.VueShopConfirmData=PetiteVue.reactive(n),f(window.VueShopConfirmData,[t,"#"+a,"#"+s])}function v(t){var e=$(t).attr("v-config");e=$.parseJSON(e),$(t).removeAttr("v-config"),e.$cart_modal=b.prefix("cart_modal_data").createCartModal(),e.product_checked=[];var a=$.extend(l(),{mounted:function(){var t=this;t.syncTotal=debounce(t._syncTotal,50),t.syncPrice=debounce(t._syncPrice,50),t.ajaxUpdataCart=debounce(t._ajaxUpdataCart,300),t.syncCartOptions(!0),t.syncPrice(),t.syncStock(),$(window).on("resize",debounce(function(){t.is_mobile=d()},200))},showItemDiscountHitModal(t){return this.discountHitModal([t],null,this.product_data)},showDiscountHitModal(){var t=this,i=[];return t.CartOptsEach(function(t,e,a,s){a.checked&&i.push(a)}),this.discountHitModal(i,null,this.product_data)},listCountChange:function(t){this.countChange(t),t.checked||this.checkItem(t)},modalCountChange:function(){this.countChange(this.cart_modal_data,!0),this.modalSyncItemPrice()},modalOptChange:function(t,i){this.cart_modal_data.options_active[t]=i,this.syncItemStock(this.cart_modal_data,this.product_data[this.cart_modal_data.product_id]),this.modalSyncItemPrice()},modalSyncItemPrice:function(){this.syncItemPrice(this.cart_modal_data),this.syncCartItemDiscountPrice(this.cart_modal_data)},syncCartItemDiscountPrice:function(t){this.syncItemDiscountPrice(t,this.discountDataDependency(t),this.product_data[t.product_id])},discountDataDependency:function(t){var i={user_data:this.user_data,product_data:{price:0,count:0},author_data:{price:0,count:0},total_data:{price:0,count:0}};if(!t||!t.prices)return i;var e={},a={};return t.checked?(this.CartOptsEach(function(t,s,o,n){o.checked&&(e[s]||(e[s]={price:0,count:0}),a[t]||(a[t]={price:0,count:0}),e[s].price+=o.prices.total_price,e[s].count+=o.selected_count,a[t].price+=o.prices.total_price,a[t].count+=o.selected_count,i.total_data.price+=o.prices.total_price,i.total_data.count+=o.selected_count)}),i.product_data=e[t.product_id],i.author_data=a[t.author_id]):(i.product_data.price=t.prices.total_price,i.product_data.count=t.selected_count,i.author_data.price=t.prices.total_price,i.author_data.count=t.selected_count,i.total_data.price=t.prices.total_price,i.total_data.count=t.selected_count),i},cartModalSubmit:function(){var t=this.cart_modal_data,i=t.author_id,e=t.product_id,a=t.options_active_str;t.product_options.length>0&&t.options_active.length!==t.product_options.length?t.product_options.forEach(function(i,e){if(!t.options_active[e])return notyf("请选择"+i.name,"warning"),!1}):(this.cart_data[i][e][a].options_active_error=!1,this.cart_data[i][e][a].options_active=o(t.options_active),this.cart_data[i][e][a].checked=!0,this.cart_data[i][e][a].selected_count=t.selected_count,this.cart_data[i][e][a].stock_all=t.stock_all,this.syncCartOptions(),this.syncPrice(),this.syncTotal(),this.ajaxUpdataCart(),this.$cart_modal.modal("hide"))},cartModal:function(t){var i=o(t);i.title=this.product_data[t.product_id].title,this.cart_modal_data=i,this.$cart_modal.modal("show")},syncCartOptions:function(t){var i=this,e=" · ";i.CartOptsEach(function(a,o,n,d){var r=i.product_data[o].product_options;if(t&&(n.cart_submit_btn_text=i.config.cart_submit_btn_text,n.product_id=o,n.author_id=a,n.product_title=i.product_data[o].product_title,n.pay_modo=i.product_data[o].pay_modo,n.show_mark=i.product_data[o].show_mark,n.product_options=r,n.limit_buy=i.product_data[o].limit_buy,n.thumbnail=i.product_data[o].thumbnail,n.url=i.product_data[o].url,n.discount=i.product_data[o].discount),n.options_active_str="",n.options_active_name="",n.selected_count=~~(n.selected_count||0),r.length>0&&("object"==typeof n.options_active&&n.options_active.length>0&&(n.options_active_str=s(n.options_active),i.isOptError(o,n)||$.each(n.options_active,function(t,i){r[t]&&r[t].opts&&r[t].opts[i]&&(n.options_active_name+=r[t].opts[i].name+e)})),""===n.options_active_name?n.options_active_name="请选择商品选项":n.options_active_name=n.options_active_name.slice(0,-e.length)),""===n.options_active_str&&(n.options_active_str="0"),n.options_active_str!=d){$new_product_id_data={},i.cart_data[a][o][n.options_active_str]&&(n.selected_count+=~~i.cart_data[a][o][n.options_active_str].selected_count,delete i.cart_data[a][o][n.options_active_str]);for(let t in i.cart_data[a][o])t===d?$new_product_id_data[n.options_active_str]=n:$new_product_id_data[t]=i.cart_data[a][o][t];i.cart_data[a][o]=$new_product_id_data}})},getHttpData:function(){var t=this,i={};return t.CartOptsEach(function(t,e,a){i[e]||(i[e]={});var s=a.options_active_str;i[e][s]=a.selected_count}),i},_ajaxUpdataCart:function(){var t=this.getHttpData();$.ajax({type:"POST",url:_win.ajax_url,data:{action:"update_cart",cart_data:t},dataType:"json",error:function(t){console.error("更新购物车数据失败",t)},success:function(t){t.error&&console.error(t.msg||"更新购物车数据失败",t),t.count>0&&c(t.count)}})},removeChecked:function(){if(this.total_data.checked_data.length&&confirm("确定要移出选中商品吗？")){var t=this;$.each(t.total_data.checked_data,function(i,e){t.removeItem(e.author_id,e.product_id,e.opt_key)})}},removeItem:function(t,i,e,a){var s=this;if(!a||confirm("确定要移出该商品吗？")){var o=$('.v-cart [data-author-id="'+t+'"] [data-product-id="'+i+'"] [data-optkey="'+e+'"]');o.css({background:"rgba(255,46,46,0.05)"}).slideUp(200,function(){delete s.cart_data[t][i][e],$.isEmptyObject(s.cart_data[t][i])&&delete s.cart_data[t][i],$.isEmptyObject(s.cart_data[t])&&delete s.cart_data[t],s.syncPrice(),s.syncTotal(),s.ajaxUpdataCart()})}},checkAuthor:function(t){var i=this;$.each(i.cart_data[t],function(e,a){$.each(a,function(e,a){i.author_data[t].checked_status?a.checked=!1:a.selected_count>0&&0!=a.stock_all&&!i.isOptError(a.product_id,a)?a.checked=!0:a.checked=!1})}),this.syncTotal()},checkAll:function(){var t=this;t.CartOptsEach(function(i,e,a){t.total_data.checked_status?a.checked=!1:a.selected_count>0&&0!=a.stock_all&&!t.isOptError(a.product_id,a)?a.checked=!0:a.checked=!1}),this.syncTotal()},checkItem:function(t){if(0==t.stock_all)return t.checked=!1,notyf("商品库存不足","warning");if(0==t.selected_count)return t.checked=!1,notyf("请先选择购买数量","warning");if(t.checked)t.checked=!1;else{if(this.isOptError(t.product_id,t))return t.checked=!1,notyf("请先选择商品选项","warning");t.checked=!0}this.syncTotal()},goConfirm:function(){var t=this,i={};if(t.total_data.is_can_pay){t.CartOptsEach(function(t,e,a){if(a.checked){i[e]||(i[e]={});var s=a.options_active_str;i[e][s]=a.selected_count}});var e={products:i,is_cart:!0};u(e)}},_syncTotal:function(){var t=this,e=[],a=0,s=0,o=0,n=0,d=0,r=0,c=0,l="",u="",m=0,_={},p={},v={yes:0,no:0},h=t.config.is_edit,f={};t.discountDataDependency();t.CartOptsEach(function(i,g,b){if(p[i]||(p[i]={yes:0,no:0}),b.checked){t.isOptError(g,b)?(b.checked=!1,p[i].no++,v.no++,h||debounce_notyf("请选择商品["+t.product_data[g].product_title+"]的商品选项","warning")):(p[i].yes++,v.yes++),m++,a+=~~b.selected_count,_[g]||(_[g]=0),_[g]+=~~b.selected_count,e.push({author_id:i,product_id:g,opt_key:b.options_active_str}),1===m&&(l=t.product_data[g].pay_modo,u=t.product_data[g].show_mark),f[g]||(f[g]=0);var y=Number(b.prices.total_price);f[g]+=y,"points"===t.product_data[g].pay_modo?(o+=y,n+=y,c++):(s+=y,d+=y,r++)}else p[i].no++,v.no++}),$.each(f,function(i,e){t.product_data[i].prices.total_price=e}),$.each(p,function(i,e){t.author_data[i].checked_status="",e.yes>0&&(t.author_data[i].checked_status="checked",e.no>0&&(t.author_data[i].checked_status="portion"))});var g=t.total_data;g.checked_status="",v.yes>0&&(g.checked_status="checked",v.no>0&&(g.checked_status="portion")),g.pay_modo=l,g.show_mark=u,g.checked_data=e,g.count=a,g.price_count=r,g.points_count=c,g.price=i(s),g.discount_price=i(d),g.points=~~o,g.discount_points=~~n;var b=a>0;$.each(_,function(i,e){if(t.isStockLow(i,e)&&(b=!1,h||debounce_notyf("商品["+t.product_data[i].title+"]库存不足，请调整选择","warning")),t.isLimitBuy(i,e)){b=!1;var a="商品["+t.product_data[i].title+"]限购"+t.product_data[i].limit_buy.limit+"件，请调整选择";0==t.product_data[i].limit_buy.limit&&(a="商品["+t.product_data[i].title+"]限购，无法购买，请调整选择"),h||debounce_notyf(a,"warning")}}),g.is_mix=!1,r>0&&c>0&&(b=!1,g.is_mix=!0,
h||debounce_notyf("请勿同时选择积分和现金商品","error")),b&&(g.discount_points=0,g.discount_price=0,t.CartOptsEach(function(e,a,s){if(t.syncCartItemDiscountPrice(s),s.checked){var o=Number(s.prices.total_discount_price);"points"===g.pay_modo?g.discount_points+=~~o:g.discount_price+=i(o)}})),g.is_can_pay=b},isOptError:function(t,i){return i.options_active_error=!1,!!this.product_data[t].product_options.length&&(this.product_data[t].product_options.length>0&&this.product_data[t].product_options.length!==i.options_active.length&&(i.options_active_error=!0,!0))},isLimitBuy:function(t,i){return!!(this.product_data[t].limit_buy.is_limit&&i>this.product_data[t].limit_buy.limit)},isStockLow:function(t,i){return this.product_data[t].stock_all>=0&&"opts"!==this.product_data[t].stock_type&&i>this.product_data[t].stock_all},syncStock:function(){var t=this;t.CartOptsEach(function(i,e,a){t.syncItemStock(a,t.product_data[e])})},countChange:function(t,i){if(t.stock_all>=0&&t.selected_count>t.stock_all)return t.selected_count=Math.max(t.stock_all,1),notyf("库存不足","warning");if(this.isLimitBuy(t.product_id,t.selected_count)){t.selected_count=Math.max(t.selected_count-1,1);var e="当前商品限购"+this.product_data[t.product_id].limit_buy.limit+"件";return 0==this.product_data[t.product_id].limit_buy.limit&&(e="当前商品限购，无法购买"),notyf(e,"warning")}i||(this.syncPrice(),t.checked&&this.syncTotal(),this.ajaxUpdataCart())},_syncPrice:function(){var t=this;t.CartOptsEach(function(i,e,a){t.syncItemPrice(a,t.product_data[e]),t.syncCartItemDiscountPrice(a)})},CartOptsEach:function(t){var i=this;$.each(i.cart_data,function(i,e){$.each(e,function(e,a){$.each(a,function(a,s){t(i,e,s,a)})})})}},e);window.vue_cart_data=PetiteVue.reactive(a),f(window.vue_cart_data)}function h(i){var e=$(i).attr("v-config");e=$.parseJSON(e),$(i).removeAttr("v-config"),e.stock_all=~~e.stock_all,e.options_active_str="",e.options_active=[],e.selected_count=1,e.discount_hit=[],e.important_discount=[],e.$cart_modal=b.createProductModal();var o=$.extend(l(),{getOptionsActiveName(t){if(0===t.length)return"";var i=" · ",e=this,a="";return t.forEach(function(t,s){a+=e.product_options[s].opts[t].name+i}),a.slice(0,-i.length)},mounted:function(){var t=this;t.product_options.forEach(function(i,e){t.options_active[e]=0,t.options_active_str+=a(e,"0")}),t.syncPrice=debounce(this._syncPrice,100),t.cartModalSubmit=debounce(this._cartModalSubmit,200),t.orderModalSubmit=debounce(this._orderModalSubmit,200),t.syncStock(),t.syncPrice();for(var i=0;i<t.discount.length;i++)if(t.discount[i].is_important&&t.discount[i].is_valid){t.important_discount=t.discount[i];break}$(window).on("resize",debounce(function(){t.is_mobile=d()},200))},cartBtnClick:function(t){this.is_mobile?this.cartModalShow():this.addCart(t)},orderBtnClick:function(t){this.is_mobile?this.cartModalShow():this.orderSubmit(t)},cartModalShow:function(){this.$cart_modal.modal("show")},cartModalHide:function(){this.is_mobile&&this.$cart_modal.modal("hide")},modalOptChange:function(t,i){this.optChange(t,i)},modalCountChange:function(t){this.countChange(t)},_cartModalSubmit:function(t){this.addCart(t)},_orderModalSubmit:function(t){this.orderSubmit(t),this.cartModalHide()},orderSubmit:function(t){if(this.user_data.user_id){var i={products:{}};i.products[this.product_id]={},i.products[this.product_id][this.options_active_str]=this.selected_count,u(i)}else r()},addCart:function(t){if(this.user_data.user_id){var i=$(t.target),e=this;zib_ajax(i,{action:"cart_add",product_id:this.product_id,options_active:this.options_active_str,count:this.selected_count},function(t){e.cartModalHide(),e.cartAddAnimate(t.count)},"stop")}else r()},cartAddAnimate:function(i){var e=this.thumbnail_url,a='<img class="fit-cover" src="'+e+'">',s=$('<div class="cart-add-animate flex jc fixed"><div class="animate-img"><div class="img-box">'+a+"</div></div></div>");s.appendTo("body");var o,n="cubic-bezier(0.6, -0.57, 1, 1)";if(this.is_mobile?o=$(".tabbar-cart"):(n="linear",o=$(".nav-cart")),!o.length)return s.remove();var d=t(s,o);setTimeout(function(){var t=.4;s.css({transform:"translate3d(0, "+d.y+"px, 0)",transition:"transform "+t+"s "+n}).find(".animate-img").css({transform:"translate3d("+d.x+"px, 0, 0)",transition:"transform "+t+"s linear"}),setTimeout(function(){i>0&&c(i),o.addClass("add-animate"),setTimeout(function(){o.removeClass("add-animate"),i>0&&c(i)},300),s.remove()},1e3*t)},200)},optChange:function(t,i){this.options_active[t]=i,this.options_active_str=s(this.options_active),this.syncStock(),this.syncPrice()},countChange:function(){this.syncPrice()},countMaxChange:function(){var t=this.selected_count+1;if(this.stock_all>=0&&t>this.stock_all)return notyf("库存不足","warning");if(this.limit_buy.is_limit&&t>this.limit_buy.limit){var i="当前商品限购"+this.limit_buy.limit+"件";return 0==this.limit_buy.limit&&(i="当前商品限购，无法购买"),notyf(i,"warning")}},_syncPrice:function(){this.syncItemPrice(this);var t={user_data:this.user_data,product_data:{price:this.prices.total_price,count:this.selected_count},author_data:{price:this.prices.total_price,count:this.selected_count},total_data:{price:this.prices.total_price,count:this.selected_count}};this.syncItemDiscountPrice(this,t)},syncStock:function(){this.syncItemStock(this)},getOptStock:function(){}},e);f(o)}function f(t,e){var a={"transition-group":function(t){function i(){d.observe(e,{childList:!0,attributes:!0,subtree:!1})}const e=t.el,a=function(t){return t.getAttribute("transition-key")},s=function(t){return{left:t.offsetLeft,top:t.offsetTop}};let o=new Map;const n=()=>{const t=Array.from(e.children);o.clear(),t.forEach(t=>{const i=a(t);null!==t.offsetParent&&i&&o.set(i,{dom:t,position:s(t)})})},d=new MutationObserver(t=>{const i=new Map(o);n();const e=[],s=[];o.forEach((t,a)=>{i.has(a)||e.push(o.get(a))}),i.forEach((t,e)=>{o.has(e)||s.push(i.get(e))}),e.forEach(t=>{var i=t.dom;i.style.opacity="0",i.style.transform="translate3d(20px, 0, 0)"}),o.forEach(t=>{var e=t.dom;const s=i.get(a(e)),n=o.get(a(e));if(s&&n){var d=s.position.left-n.position.left,r=s.position.top-n.position.top;e.style.transform=`translate3d(${d}px, ${r}px, 0)`}}),setTimeout(()=>{o.forEach(t=>{var i=t.dom;i.style.transition="all 0.3s ease",i.style.opacity=1,i.style.transform="translate3d(0, 0, 0)",setTimeout(()=>{i.style.transform="",i.style.transition="",i.style.opacity=""},300)})},20)});return setTimeout(()=>{n(),i()},16),()=>{d.disconnect()}},transition:function(t){const i=t.el,e=t.get();let a="none"!==i.style.display;i.style.transition="opacity 0.3s ease, transform 0.3s ease",t.effect(()=>{const e=t.get();e&&a||!e&&!a||(e?(i.style.opacity="0",i.style.transform="translateY(-10px)",i.style.display="",i.offsetHeight,i.style.opacity="1",i.style.transform="translateY(0)",a=!0):(i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{t.get()||(i.style.display="none",a=!1)},300)))}),!e&&a?(i.style.display="none",a=!1):e&&!a&&(i.style.display="",a=!0)},"discount-badge":function(t){function i(i){var e=t.el.getAttribute("data-hit-discount");if(!e)return!0;var a=t.get(e);return!(!a||0===a.length)&&a.some(function(t){return t.id===i.id})}var e=function(e,a){if(!a||0===a.length)return e.innerHTML="",void e.classList.add("hide");e.classList.remove("hide");var s="",o=t.modifiers&&t.modifiers.hit;a.forEach(function(t){(t.is_valid||o)&&(s+='<span class="badge badge-discount'+(i(t)?"":" no-hit")+'">'+(t.small_badge||t.name)+"</span>")}),e.innerHTML=s};e(t.el,t.value),t.effect(()=>{e(t.el,t.get())})},"limit-buy":function(t){var i=function(t,i){if(!i||!i.is_limit)return t.innerHTML="",void t.classList.add("hide");t.classList.remove("hide");var e="限购："+i.limit;0==i.limit&&(e="已限购"),t.innerHTML=e,$(t).data("limitBuy",o(i))};$(t.el).on("click",function(){function t(t,i){t=Number(t);var e="限购"+t+"件";return-1===t&&(e="不限购"),0==t&&(e="无法购买"),'<div class="flex ac jsb list-mt20"><div class="muted-2-color">'+i+'</div><div class="">'+e+"</div></div>"}var i=$(this).data("limitBuy");if(i&&i.is_limit){var e="",a="",s='<div class="border-title touch"><div class="flex jc"><b>商品限购</b></div></div>';return $.each(i.key_names,function(a,s){e+=t(i[a],s)}),e=(i.desc?'<div class="muted-color mb10">'+i.desc+"</div>":"")+'<div class="muted-box">'+e+"</div>",i.limit_all||i.bought_count?e+='<div class="muted-box mt10 c-yellow text-center">此商品您已下单'+i.bought_count+"件，"+(i.limit?"还可购买"+i.limit+"件":"已无法购买")+"</div>":e+='<div class="muted-box mt10 c-yellow text-center">此商品您可购买'+i.limit+"件</div>",a='<div class="">'+e+"</div>",refresh_modal({class:"shop-modal modal-mini full-sm",mobile_from_bottom:!0,content:'<button class="close abs-close" data-dismiss="modal"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="">'+s+a+"</div>"})}}),$(t.el).css("cursor","help").attr("title","查看限购规则"),i(t.el,t.value),t.effect(()=>{i(t.el,t.get())})},price:function(t){var e=function(t,e){function a(t){var e=i(t).toString(),a=e.split("."),s=a[0];if(a[1]&&n.includes(".")){var o=n.split("."),d=o[1]?o[1].length:0,r=a[1]?a[1].substring(0,d):"";r.length<d&&(r=r.padEnd(d,"0")),s+='<span class="decimal-part">.'+r+"</span>"}return s}function s(t,i,e,s){let n=null;const d=o=>{n||(n=o);const r=Math.min((o-n)/s,1),c=i+(e-i)*r;t.innerHTML=a(c),r<1&&window.requestAnimationFrame(d)};window.requestAnimationFrame?window.requestAnimationFrame(d):t.innerHTML=a(o)}if(null==e)return void(t.innerHTML="0");const o=e,n=i(o).toString();let d=0;if(t.textContent){const i=t.textContent.replace(/[^\d.-]/g,"");d=parseFloat(i)||0}d!==o&&s(t,d,o,200)};e(t.el,t.value),t.effect(()=>{e(t.el,t.get())})},spinner:function(t){const i=t.get(`(val) => { ${t.exp} = val }`),e=(t,i)=>{const e=document.createEvent("HTMLEvents");e.initEvent(i,!0,!0),t.dispatchEvent(e)};var a=function(){var i=~~t.get(t.el.getAttribute("max"))||~~t.el.getAttribute("max")||1;return i},s=function(){var i=~~t.get(t.el.getAttribute("min"))||~~t.el.getAttribute("min")||1;return i},o=function(o,d){d=Number(d);var r=a(),c=s(),l='<div class="inline-flex number-spinner">';l+='<span class="minus-btn'+(c&&d<=c?" is-disabled":"")+'" data-action="minus">',l+='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-minus"></use></svg>',l+="</span>",l+='<span class="number-input">'+d+"</span>",l+='<span class="plus-btn'+(r&&d>=r?" is-disabled":"")+'" data-action="plus">',l+='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-add"></use></svg>',l+="</span>",l+="</div>",o.innerHTML=l;var u=$(o);u.on("click",".plus-btn",function(){var s=a();return s&&t.get()>=s?(e(o,"max-change"),!1):(i(t.get()+1),e(o,"change"),!1)}),u.on("click",".minus-btn",function(){var a=s();return a&&t.get()<=a?(e(o,"min-change"),!1):(i(t.get()-1),e(o,"change"),!1)});var m=new MutationObserver(function(i){i.forEach(function(i){"attributes"===i.type&&("max"!==i.attributeName&&"min"!==i.attributeName||n(t.el,t.get()))})});m.observe(t.el,{attributes:!0})},n=function(t,i){i=Number(i);var e=a(),o=s();t.querySelector(".number-input").textContent=i,t.querySelector(".minus-btn").classList.toggle("is-disabled",o&&i<=o),t.querySelector(".plus-btn").classList.toggle("is-disabled",e&&i>=e)};o(t.el,t.get()),t.effect(()=>{n(t.el,t.get())})}},s=PetiteVue.createApp(t);return $.each(a,function(t,i){s.directive(t,i)}),"object"==typeof e?$.each(e,function(t,i){s.mount(i)}):s.mount(e),s}$.fn.shopScore=function(){return this.each(function(){function t(t){var e="";e=t<=1?"非常差":t<=2?"较差":t<=3?"一般":t<=4?"较好":"非常好",s.text(e).attr("data-score",t),i.attr("score-value",t),i.find(".score-input").val(t)}var i=$(this);if(!i.attr("is-on")){for(var e=i.attr("score-value")||0,a=i.find(".score-icon"),s=i.find(".score-text"),o=5,n="",d='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-stars"></use></svg>',r=1;r<=o;r++){var c=r<=e?"active":"";n+='<i class="icon-star '+c+'" data-score="'+r+'">'+d+"</i>"}a.html(n),e>0&&t(e),i.attr("is-on",!0),i.on("click",".icon-star",function(){var i=$(this).data("score");a.find(".icon-star").each(function(){var t=$(this).data("score");t<=i?$(this).addClass("active"):$(this).removeClass("active")}),t(i)}),i.on("mouseenter",".icon-star",function(){var t=$(this).data("score");a.find(".icon-star").each(function(){var i=$(this).data("score");i<=t?$(this).addClass("hover"):$(this).removeClass("hover")})}).on("mouseleave",function(){a.find(".icon-star").removeClass("hover")})}})},$(document).on("auto_fun",function(){$(".shop-score-box").shopScore()}),d()&&$(".product-cover-slider img").each(function(){var t=$(this),i=t.clone().addClass("no-imgbox").css("transform","scaleY(-1) translateY(calc(-100% + 33px))");t.before(i)});var g=$("body");$.fn.createModal=function(t){t=t||{};var i=t.id||"",e=t.content||"",a=t.title||"",s=t.modal_class?" "+t.modal_class:"",o=t.dialog_class?" "+t.dialog_class:"",n=t.title_class?" "+t.title_class:"",d=$(window).width();a=a?'<div class="touch '+n+'">'+a+"</div>":"";var r='<div class="modal flex jc fade'+(d<769?" bottom":"")+s+'" id="'+i+'"><div class="modal-dialog'+o+'" role="document"><div class="modal-content"><button class="close abs-close" data-dismiss="modal"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="modal-body">'+a+e+'</div></div><div class="touch-close show-sm"></div></div></div>',c=$(r);return c.appendTo($(this)),d<769&&c.minitouch({direction:"bottom",selector:".modal-dialog",start_selector:".modal-colorful-header,.touch-close,.touch",onEnd:function(){c.modal("hide")},stop:function(){return!c.hasClass("bottom")}}),c};var b={this_str:"",data_prefix:"",modal_id:"",cart_modal_id:"shop-product-cart-modal",remark_modal_id:"shop-product-remark-modal",address_modal_id:"shop-product-address-modal",mounted_attr:"",mounted:function(t){return this.mounted_attr=t?' @vue:mounted="'+t+'"':"",this},prefix:function(t){return this.this_str=t,this.data_prefix=t?t+".":"",this},ModalId:function(t){return this.modal_id=t,this},productInfoBox:function(){return`\n                <div class="touch product-info-box flex jsb p-d-mb" ${this.mounted_attr}>\n                    <div class="item-thumbnail product-graphic mr10 flex jc gradient-bg" data-opacity="0.1" v-html="${this.data_prefix}thumbnail"></div>\n                    <div class="product-info flex jsb xx flex1">\n                        <div class="product-title text-ellipsis font-bold mr20">{{ ${this.data_prefix}title }}</div>\n\n                        <div class="cart-col-price product-price-box flex jsb ac">\n                            <div class="price-box" :class="${this.data_prefix}pay_modo == 'points' ? 'c-yellow' : 'c-red'">\n                                <div class="mr6">\n                                    <span class="pay-mark" v-html="${this.data_prefix}show_mark"></span>\n                                    <b class="price-str" v-price="${this.data_prefix}prices.total_discount_price"></b>\n                                </div>\n                                <div class="badg badg-sm c-yellow" v-if="${this.data_prefix}prices.total_discount">省 {{ ${this.data_prefix}prices.total_discount }}</div>\n                            </div>\n                        </div>\n                        <div v-discount-badge="${this.data_prefix}discount" data-hit-discount="${this.data_prefix}discount_hit" class="product-discount-box scroll-x mini-scrollbar" @click="discountModal(${this.data_prefix}discount)"></div>\n                    </div>\n                </div>\n                `},productOptsBox:function(){return`\n                <div class="product-opts-box mini-scrollbar scroll-y max-vh5 mb10">\n                    <div v-if="${this.data_prefix}product_options.length > 0">\n                        <div class="p-d-mb" v-for="(opt,opt_index) in ${this.data_prefix}product_options" :key="'opt-' + opt_index">\n                            <div class="product-opt-title-box flex ac jsb">\n                                <div class="product-opt-title">{{ opt.name }}</div>\n                            <div class="pointer muted-2-color ml10 em09" @click="switchOptView(opt)" v-if="optHasImg(opt)"><svg class="icon mr3" aria-hidden="true"><use xlink:href="#icon-img-lists"></use></svg>{{ opt.view_mode === 'img' ? '列表' :  '图片'  }}</div>\n                            </div>\n                            <div class="product-opt-content" :class="(opt.view_mode === 'img' ? 'mode-img' : '' ) + ' count-' + opt.opts.length">\n                                <div v-for="(item,item_index) in opt.opts" class="opt-item badg hollow" :class="item_index == ${this.data_prefix}options_active[opt_index] ? 'active' : ''" @click="modalOptChange(opt_index,item_index)" :key="'opt-' + opt_index + '-' + item_index">\n                                    <span class="opt-item-image" v-if="item.image">\n                                        <img :src="item.image" alt="">\n                                        <div class="abs-center right-top pointer alone-imgbox-img flex jc" :data-src="item.image"><i class="fa fa-expand" aria-hidden="true"></i></div>\n                                    </span>\n                                    <span class="opt-item-name">{{ item.name }}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="padding-h10 flex ac jsb border-top mt10">\n                        <div class="product-opt-title">数量</div>\n                        <div class="product-buy-num-box flex ac em09 mb6">\n                            <div class="ml10 flex mr10">\n                                <div class="stock-desc muted-color" v-effect="$el.innerHTML = stockAllText(${this.data_prefix}stock_all)"></div>\n                                <div class="limit-buy-desc  c-yellow ml6" v-limit-buy="${this.data_prefix}limit_buy"></div>\n                            </div>\n                            <div v-spinner="${this.data_prefix}selected_count" @change="modalCountChange" min="1" :max="spinnerMax(${this.this_str})"></div>\n                        </div>\n                    </div>\n                </div>\n                `},createModal:function(t){var i=`\n                <div class="modal flex jc fade" :class="is_mobile ? 'bottom' : ''" id="${this.modal_id}" style="display: none" key="${this.modal_id}" ${this.mounted_attr}>\n                    <div class="shop-modal modal-mini full-sm modal-dialog" role="document">\n                        <div class="modal-content">\n                            <button class="close abs-close" data-dismiss="modal">\n                                <svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg>\n                            </button>\n                            <div class="modal-body">\n                                ${t}\n                            </div>\n                        </div>\n                        <div class="touch-close show-sm"></div>\n                    </div>\n                </div>\n            `;g.append(i);var e=$("#"+this.modal_id);return $(window).width()<769&&e.minitouch({direction:"bottom",selector:".modal-dialog",start_selector:".modal-colorful-header,.touch-close,.touch",onEnd:function(){e.modal("hide")},stop:function(){return!e.hasClass("bottom")}}),e},cartModalbtn:function(){return`\n                <botton class="but jb-yellow-2 padding-lg btn-block" @click.prevent="cartModalSubmit">{{${this.data_prefix}cart_submit_btn_text}}</botton>\n            `},orderModalBtn:function(){return`\n                <botton class="but jb-red padding-lg btn-block" @click.prevent="orderModalSubmit">{{${this.data_prefix}order_submit_btn_text}}</botton>\n            `},createCartModal:function(){this.modal_id||this.ModalId(this.cart_modal_id);var t=this.productInfoBox()+this.productOptsBox()+this.cartModalbtn();return this.createModal(t)},createProductModal:function(){this.modal_id||this.ModalId(this.cart_modal_id);var t='<div class="border-title touch flex jc" v-if="service.length > 0">\n            <div class="c-green text-ellipsis em09 mr20 ml20">\n                <span :class="item_index !== 0 ? \'ml10\' : \'\'" class="service-item" v-for="(item,item_index) in service" :key="\'service-\' + item_index"><svg class="mr3 opacity5" aria-hidden="true"><use xlink:href="#icon-check-circle"></use></svg>{{ item.name }}</span>\n            </div>\n        </div>\n        ',i=t+this.productInfoBox()+this.productOptsBox()+'<div class="but-group shop-paybtn-group flex">'+this.cartModalbtn()+this.orderModalBtn()+"</div>";return this.createModal(i)},remarkModalBox:function(){return`\n                <div class="border-title touch"><div class="flex jc"><b>备注</b></div></div>\n                <div class="remark-modal-body">\n                    <div class="remark-modal-content mb20" style="min-height: 150px;">\n                        <textarea class="form-control" style="min-height: 120px;" v-model.trim="${this.data_prefix}remark" placeholder="请输入备注" @keyup.ctrl.enter="remarkModalSubmit"></textarea>\n                    </div>\n                </div>\n                <botton class="but jb-blue padding-lg btn-block" @click.prevent="remarkModalSubmit">确认</botton>\n            `},createRemarkModal:function(){this.modal_id||this.ModalId(this.remark_modal_id);var t=this.remarkModalBox();return this.createModal(t)},createUserRequiredModal:function(){this.modal_id||this.ModalId(this.user_required_modal_id);var t=`\n            <div class="border-title touch"><div class="flex jc"><b>请填写必要信息</b></div></div>\n            <div class="user-required-modal-body mini-scrollbar scroll-y max-vh5" style="min-height: 160px;">\n                <div class="mb20 padding-6" v-for="(user_required_item,index) in ${this.data_prefix}user_required" :key="'user_required_item-' + index">\n                    <div class="em09 muted-2-color mb6">{{ user_required_item.name }}</div>\n                    <input type="text" class="form-control" name="title" :tabindex="index + 1" v-model.trim="user_required_item.value">\n                    <div class="px12 muted-3-color mt3" v-if="user_required_item.desc" v-html="user_required_item.desc"></div>\n                    <div class="px12 c-red mt3" v-if="user_required_item.error">{{ user_required_item.error }}</div>\n                </div>\n            </div>\n            <botton class="but jb-blue padding-lg btn-block" @click.prevent="userRequiredModalSubmit">确认</botton>\n            `;return this.createModal(t)},userAddressModalBox:function(){return'\n            <div class="border-title touch"><div class="flex jc"><b>{{ is_edit ? \'编辑收货地址\' : \'添加收货地址\' }}</b></div></div>\n                <div class="address-form">\n                    <!-- 收货人姓名 -->\n                    <div class="form-group">\n                        <div class="input-group">\n                            <div class="input-group-addon"><i class="fa fa-user"></i></div>\n                            <input type="text" class="form-control" v-model="form.name" placeholder="收货人姓名" maxlength="20" />\n                        </div>\n                        <div class="help-block error-block px12 c-red" v-if="errors.name">{{ errors.name }}</div>\n                    </div>\n\n                    <!-- 手机号码 -->\n                    <div class="form-group">\n                        <div class="input-group">\n                            <div class="input-group-addon"><i class="fa fa-phone"></i></div>\n                            <input type="tel" class="form-control" v-model="form.phone" placeholder="手机号码" maxlength="30" />\n                        </div>\n                        <div class="help-block error-block px12 c-red" v-if="errors.phone">{{ errors.phone }}</div>\n                    </div>\n                    \n                    <!-- 地区选择 -->\n                    <div class="form-group">\n                        <div class="region-select flex" v-if="$.isEmptyObject(regions)">\n                            <div class="flex1 mr10">\n                                <input type="text" class="form-control" v-model="form.province" placeholder="请输入省份" />\n                            </div>\n                            <div class="flex1 mr10">\n                                <input type="text" class="form-control" v-model="form.city" placeholder="请输入城市"/>\n                            </div>\n                            <div class="flex1">\n                                <input type="text" class="form-control" v-model="form.county" placeholder="请输入区县"/>\n                            </div>\n                        </div>\n                        <div class="region-select flex" v-else>\n                            <div class="form-select flex1">\n                                <select class="form-control" v-model="form.province" @change="provinceChange">\n                                    <option value="">选择省份</option>\n                                    <option v-for="(province, index) in regions" :key="\'province-\' + index" :value="index">{{ index }}</option>\n                                </select>\n                            </div>\n                            <div class="form-select flex1 ml10">\n                                <select class="form-control" v-model="form.city" @change="cityChange" ref="regionCitySelect">\n                                    <option value="">选择城市</option>\n                                    <option v-for="(city, index) in cities" :key="\'city-\' + index" :value="index">{{ index }}</option>\n                                </select>\n                            </div>\n                            <div class="form-select flex1 ml10" v-if="!$.isEmptyObject(counties)">\n                                <select class="form-control" v-model="form.county" ref="regionCountySelect">\n                                    <option value="">选择区县</option>\n                                    <option v-for="(county, index) in counties" :key="\'county-\' + index" :value="county">{{ county }}</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class="help-block error-block px12 c-red" v-if="errors.region">{{ errors.region }}</div>\n                    </div>\n\n                    <!-- 详细地址 -->\n                    <div class="form-group">\n                        <div class="input-group">\n                            <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>\n                            <input type="text" class="form-control" v-model="form.address" placeholder="详细地址，如街道、门牌号等" maxlength="100" />\n                        </div>\n                        <div class="help-block error-block px12 c-red" v-if="errors.address">{{ errors.address }}</div>\n                    </div>\n\n                    <!-- 地址标签 -->\n                    <div class="form-group">\n                        <div class="address-tags">\n                            <div class="em09 muted-2-color mb10">地址标签：</div>\n                            <div class="tag-list">\n                                <span class="tag-item mb6 mr6 badg p2-10 pointer" v-for="tag in tag_list" :key="tag" :class="form.tag === tag ? \'active\' : \'\'" @click="form.tag = tag">{{ tag }}</span>\n                                <span v-if="!showCustomInput" class="badg p2-10 pointer mb6" :class="form.tag === customTag ? \'active\' : \'\'" @click="showCustomTagInput">{{ customTag || \'自定义\' }}</span>\n                                <span v-else class="tag-item custom-tag">\n                                    <input type="text" class="badg-form badg p2-10 mb6" v-model="customTag" @blur="setCustomTag" @keyup.enter="setCustomTag" ref="customTagInput" maxlength="5" placeholder="自定义标签 最多5个字" />\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- 设为默认地址 -->\n                    <div class="muted-box padding-10 mb10">\n                        <label class="muted-color flex ac jsb" style="font-weight: normal; margin: 0">\n                            <input class="hide" type="checkbox" v-model="form.is_default" />\n                            设为默认收货地址\n                            <div class="form-switch flex0"></div>\n                        </label>\n                    </div>\n\n                </div>\n            <div class="modal-buts but-average">\n                <button type="button" class="but" data-dismiss="modal">取消</button>\n                <button type="button" class="but c-blue" @click="editSaveAddress" ref="editSaveAddressBtn">保存</button>\n            </div>\n            '},userManageAddressModalBox:function(){return'\n<div class="border-title touch">\n    <div class="flex jc"><b>收货地址</b></div>\n</div>\n<div class="user-address-list-modal">\n    <div class="address-list mini-scrollbar scroll-y max-vh5 mb10">\n        <!-- 地址列表 -->\n        <div class="address-item muted-box padding-10 mb10 pointer" v-for="(item, index) in addresses" :key="\'address-\' + index" :class="selectedAddressId === item.id ? \'active\' : \'\'" @click="selectAddress(item)">\n            <div class="address-content">\n                <div class="address-detail muted-color flex ac">\n                    <div class="name-phone mb6">\n                        <span class="name">{{ item.name }}</span>\n                        <span class="phone ml10">{{ item.phone }}</span>\n                        <span class="badg badg-sm c-blue" v-if="item.tag">{{ item.tag }}</span>\n                    </div>\n                </div>\n                <div class="address-detail muted-2-color em09 mb6">{{ item.province }} {{ item.city }} {{ item.county }} {{ item.address }}</div>\n            </div>\n            <div class="address-actions flex ac jsb">\n                <span class="default-badge badg badg-sm c-red" v-if="item.is_default">默认</span>\n                <button class="default-badge but but-sm c-blue flex ac" v-else @click.prevent.stop="setDefaultAddress" :item-id="item.id">设为默认</button>\n                <div class="action-btns px12">\n                    <button class="but p2-10" @click.prevent.stop="editAddress(item)">编辑</button>\n                    <button class="but c-red p2-10 ml6" @click.prevent.stop="deleteAddress(item.id)" v-if="!item.is_default">删除</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- 空状态 -->\n        <div class="address-empty flex jc mt20 mb20" v-if="!addresses.length">\n            <div class="empty-icon c-yellow text-center">\n                <i class="fa fa-map-marker  em3x mb20"></i>\n                <div class="empty-text">您还没有添加收货地址</div>\n                <button type="button" class="mt20 but hollow c-blue padding-lg" @click="addNewAddress">立即添加</button>\n            </div>\n        </div>\n    </div>\n    <div class="modal-buts but-average">\n        <button type="button" class="but c-blue" @click="addNewAddress">添加新地址</button>\n    </div>\n</div>\n\n            '},userAddAddressModal:function(){this.modal_id||this.ModalId("user-address-modal");var t=this.userAddressModalBox();return this.createModal(t)},userManageAddressModal:function(){this.modal_id||this.ModalId("user-address-modal");var t=this.userManageAddressModalBox();return this.createModal(t)}};$(".vue-mount").length&&tbquire(["main","petite-vue","pay"],function(){$(".v-shop-detail").length&&h(".v-shop-detail"),$(".v-cart").length&&v(".v-cart")}),g.on("click",".shop-user-order-tab-btn",function(){var t=$(this),i=$("#user-tab-order > .post_ajax_trigger > .ajax-next");if(i.length){var e=t.attr("second-tab");e&&i.attr("href",i.attr("href")+"&tab="+e)}}),g.on("click",".expand-toggle",function(){var t=$(this),i="expanded",e=t.hasClass(i),a=t.attr("closest-selector"),s=~~t.attr("expand-count"),o=t.attr("find-selector"),n=null;a&&(n=t.closest(a)),n&&n.length||(n=t.parent()),o=o||">*",
o+=s?":nth-child(n+"+s+")":"";var d=n.find(o),r=t.attr("collapse-text")||"收起更多信息",c=t.attr("expand-text")||"展开全部信息";e?(d.addClass("hide"),t.removeClass(i+" hide").find(".btn-text").html(c)):(d.removeClass("hide"),t.addClass(i).find(".btn-text").html(r))})})();