(function(e,t){"use strict";function i(i,a,s){function o(){u(),s.exclude&&(i+=":not("+s.exclude+")");var t=a?a+" "+i:i;a=!!s.group&&a,setTimeout(function(){c(i,a)},1e3),W.data("imgbox-ison-"+t)||(W.on("click",t,function(){var t=e(this);n(t,a)}),W.data("imgbox-ison-"+t,!0))}function n(t,i){var a=r(t,i);if(a.slide){a.node_length>1?e(".imgbox-an .toggle-palay").show():e(".imgbox-an .toggle-palay").hide(),e(j+" .swiper-imgbox .swiper-wrapper").html(a.slide),s.thumbs&&e(j+" .swiper-thumbsbox .swiper-wrapper").html(a.thumbs);var o=~~t.attr("imgbox-index")||0;setTimeout(function(){s.thumbs&&V.update(),I.update(),I.slideTo(o,2),I.autoplay.stop(),w()},16),_(t)}}function r(t,i){var a=t.data(M);if(a)return a;var s=i?e(t.parents(i)[0]):{};if(s.length){var o=s.data(M);if(o&&o.node_length==l(s))return o}return d(t,s)}function l(e){return e.find(i).length}function c(t,i){i?e(i).each(function(){var i=e(this);i.data(M)||d(i.find(t).eq(0),i)}):e(t).each(function(){var t=e(this);t.data(M)||d(t,{})})}function d(t,a){var o={slide:"",thumbs:"",length:0};if(a.length){var n=0;a.find(i).each(function(t){0==t&&(n=0);var i=e(this);E(i)||(i.attr("imgbox-index",n),o.slide+=F(i),o.length=n+1,s.thumbs&&(o.thumbs+=S(i)),n++)}),o.node_length=l(a),a.data(M,o)}else E(t)||t.find("img").length||(o.slide=F(t),o.length=n,t.data(M,o));return o}function u(){if(!T.length){var t='<div class="swiper-imgbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',i='<div class="swiper-thumbsbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>',a=s.down?'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>':"";s.group&&(a+=s.play?'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>':"",s.thumbs&&(a+='<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',t+=i)),a+=s.zoom?'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>':"",a+=s.full?'<a href="javascript:;" class="hide-sm toggle-full toggle-radius mr6" title="切换全屏"><i class="fa fa-expand"></i></a>':"",a+='<a href="javascript:;" title="关闭" class="icon-close toggle-radius"><svg viewBox="0 0 1024 1024" class="icon em12"><path d="M573.44 512.128l237.888 237.696a43.328 43.328 0 0 1 0 59.712 43.392 43.392 0 0 1-59.712 0L513.728 571.84 265.856 819.712a44.672 44.672 0 0 1-61.568 0 44.672 44.672 0 0 1 0-61.568L452.16 510.272 214.208 272.448a43.328 43.328 0 0 1 0-59.648 43.392 43.392 0 0 1 59.712 0l237.952 237.76 246.272-246.272a44.672 44.672 0 0 1 61.568 0 44.672 44.672 0 0 1 0 61.568L573.44 512.128z"></path></svg></a>',W.append('<div class="'+q+'" id="'+R+'"><div class="modal-backdrop imgbox-bg"></div><div class="imgbox-an">'+a+"</div>"+t+"</div>"),T=e(j),g(),p()}}function g(){var i=j+" .swiper-imgbox",a=~~((e(t).width()+1600)/600),o={mousewheel:{speed:10}};o.speed=100*a,o.zoom={maxRatio:e(t).width()<769?3:2},o.autoplay={disableOnInteraction:!1},o.grabCursor=!0,o.navigation={nextEl:i+" .swiper-button-next",prevEl:i+" .swiper-button-prev"},o.keyboard={enabled:!0,onlyInViewport:!1},o.pagination={el:i+" .counter-con",type:"custom",renderCustom:function(e,t,i){return i>1?'<badge class="b-black counter">'+t+"/"+i+"</badge>":""}},s.thumbs&&s.group&&(m(),o.thumbs={swiper:V,autoScrollOffset:~~(a/1.6)}),O.swiper=I=new Swiper(i,o)}function m(){var e=j+" .swiper-thumbsbox",t={watchSlidesVisibility:!0};t.navigation={nextEl:e+" .swiper-button-next",prevEl:e+" .swiper-button-prev"},t.slidesPerView="auto",t.freeMode=!0,t.freeModeSticky=!0,O.thumbs_swiper=V=new Swiper(e,t)}function p(){T.data("is_on")||(k(),T.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",z),T.on("click",".imgbox-an .toggle-thumbs,.hide-but",function(){T.toggleClass("show-thumb")}),T.on("click",".imgbox-an .img-down",function(){var t=e(this),i=T.find(".swiper-imgbox .swiper-slide-active img"),a=i.attr("data-src")||i.attr("src"),s=a.substring(a.lastIndexOf("/")+1)||a;t.attr("href",a).attr("download",s)}),T.on("click",".imgbox-an .toggle-palay",function(){var t=e(this);t.hasClass("is-play")?I.autoplay.stop():I.autoplay.start(),t.toggleClass("is-play")}),T.on("click",".imgbox-an .toggle-zoom",function(){var t=e(this);I.zoom.toggle(),t.toggleClass("is-zoom")}),T.on("click",".imgbox-an .toggle-full",function(){document.fullscreenElement?h():f()}),T.data("is_on",!0))}function f(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(),e(j+" .imgbox-an .toggle-full .fa").removeClass("fa-expand").addClass("fa-compress"),e(j+".show").addClass("full-screen")}function h(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()),e(j+" .imgbox-an .toggle-full .fa").removeClass("fa-compress").addClass("fa-expand"),T.removeClass("full-screen")}function v(e){return-1==e.indexOf("base64,")&&e.length<300?e.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,""):e}function b(t){var i=t.offset(),a=i.top,s=i.left,o=e(document).scrollTop(),n=t.height(),r=t.width(),l=a-o+n/2,c=s+r/2;T.attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")}function w(){var t=e(j+" .imgbox-an .toggle-thumbs,.hide-but");s.thumbs&&t.length&&(I.slides.length>1?t.show():(T.removeClass("show-thumb"),t.hide()))}function x(){var e=t.innerWidth;if(!e){var i=document.documentElement.getBoundingClientRect();e=i.right-Math.abs(i.left)}return document.body.clientWidth<e}function y(){var e=W.data("scrollbar-width");if(void 0!==e)return e;var t=document.createElement("div");t.className="modal-scrollbar-measure",W.append(t);var i=t.offsetWidth-t.clientWidth;return W[0].removeChild(t),W.data("scrollbar-width",i),i}function C(){var t=parseInt(W.css("padding-right")||0,10),i=y();x()&&(W.css("padding-right",t+i),D.each(function(t,a){var s=a.style.paddingRight,o=e(a).css("padding-right");e(a).data("padding-right",s).css("transition","none").css("padding-right",parseFloat(o)+i+"px")}))}function _(e){C(),W.addClass("imgbox-show"),b(e),T.addClass("show").removeClass("hide")}function z(){W.removeClass("imgbox-show").css("padding-right",""),D.css("padding-right",""),setTimeout(function(){D.css("transition","")},10),T.addClass("hideing").removeClass("show"),h(),setTimeout(function(){T.removeClass("hideing").addClass("hide").attr("style",""),e(".toggle-palay.is-play").removeClass("is-play");try{I.zoom.out(),I.autoplay.stop()}catch(e){console.log(e)}e(j+" .swiper-close").css({opacity:"",transform:""})},300)}function k(){T.on("touchmove pointermove MSPointerMove",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),T.minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(e,t){var i=t.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return i&&i>1},onIng:function(e,t,i,a){var s=(150-a)/80;s=s<1&&s>.2&&s,t.css("opacity",s)},inEnd:function(e,t){t.css({opacity:""})},onEnd:function(e,t){T.attr("style","--imgbox-origin-top:"+i+"px;--imgbox-origin-left:conter;");var i=t.height();t.css({transform:"translate3D(0px, "+i+"px, 0px)",transition:".2s linear",opacity:0}),setTimeout(z,150)}})}function F(e){var t=e.attr("src")||e.attr("box-img"),i=e.attr("data-src");if(!t&&!i)return"";var a=e.attr("data-full-url")||v(i||t),s='<img src="'+t+'" data-src="'+a+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',o='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+s+"</div></div></div>";return o}function S(e){var t=e.attr("data-src")||e.attr("src");if(!t)return"";var i='<img data-src="'+t+'"  class="lazyload fit-cover">',a='<div class="swiper-slide">'+i+"</div>";return a}function E(e){var t=e.attr("data-src")||e.attr("src");if(!t)return!1;t=v(t);var i=e.parent("a");if(!i.length)return!1;var a=i.attr("box-img")||i.attr("href");return a=v(a),a&&(-1==a.indexOf(t)||-1==t.indexOf(a))}var q="mini-imgbox imgbox",R="mini-imgbox",M="imgbox_data",j="#"+R,T=e(j),O=t.Miniimgbox,I=O.swiper,V=O.thumbs_swiper,W=e("body"),D=e(".nav-fixed header");s.group||(s.thumbs=!1),o()}var a=function(e,t){return i(e,t,a.options)};a.options={group:!0,thumbs:!0,down:!0,play:!0,zoom:!0,full:!0,exclude:".no-imgbox,.avatar,.img-icon,.avatar-badge,.smilie-icon"},a.swiper="",a.thumbs_swiper="",t.Miniimgbox=a,tbquire(["swiper"],function(){e("link#swiper").length||e("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">'),a.options.group="group"===_win.imgbox_type,a.options.thumbs=_win.imgbox_thumbs,a.options.down=_win.imgbox_down,a.options.play=_win.imgbox_play,a.options.zoom=_win.imgbox_zoom,a.options.full=_win.imgbox_full,a(".alone-imgbox-img,a[data-imgbox]"),a("img",".wp-posts-content"),a("img",".imgbox-container"),a(".box-img",".comment-content")})})(jQuery,window);